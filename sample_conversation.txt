(renv) aravindagadamsetty@ki0940:~/cd/imgbot$ python3 -m shopping_assistant.main
ğŸ›ï¸ AI Product Search Assistant (LangGraph Powered)
Type 'quit' to exit, 'reset' to restart, or 'image <path>' to search with an image.

ğŸ‘¤ You: image test/1532.jpg

ğŸ”„ Turn 1 | User: search with this image
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: intent_classifier
ğŸ’­ Reasoning: The user wants to search using an image, which is a product search action. There are no current or historical search results available, and the input does not match FAQ, cart, small talk, or out-of-domain criteria.
ğŸ” Search context: Current=0, Historical=False
ğŸ¯ Classifying user intent...
âœ… Intent detected: product_search
ğŸ” Extracting entities...
ğŸ–¼ï¸ Processing multimodal input (text + image)...
âœ… Extracted entities (multimodal): {'product_type': 't-shirt', 'brand': 'Puma', 'color': 'light grey', 'gender': 'male', 'pattern': 'graphic'}
ğŸ§µ Stitching conversation context...
ğŸ§© First turn â€” no stitching needed
ğŸ” Searching vector database...
ğŸ“ Search text: product_type: t-shirt. brand: Puma. color: light grey. gender: male. pattern: graphic
ğŸ–¼ï¸ Processing hybrid search (image + text)...
ğŸ”€ Combining embeddings: Image(80%) + Text(20%)
âœ… Processed result 1: Puma T-shirt - â‚¹1480.5
âœ… Processed result 2: Puma T-shirt - â‚¹421.51
âœ… Processed result 3: Puma T-shirt - â‚¹1087.69
âœ… Processed result 4: Puma T-shirt - â‚¹1689.5
âœ… Processed result 5: Puma T-shirt - â‚¹724.26
âœ… Processed result 6: Puma T-shirt - â‚¹369.85
âœ… Processed result 7: Puma T-shirt - â‚¹630.21
âœ… Processed result 8: Nike T-shirt - â‚¹1625.59
âœ… Processed result 9: Puma T-shirt - â‚¹1647.62
âœ… Processed result 10: Nike T-shirt - â‚¹372.31
âœ… Processed result 11: USPA T-shirt - â‚¹1847.7
âœ… Processed result 12: Hurley T-shirt - â‚¹1128.53
âœ… Processed result 13: Uniqlo T-shirt - â‚¹1937.0
âœ… Processed result 14: Nike T-shirt - â‚¹1201.52
âœ… Processed result 15: Hurley T-shirt - â‚¹1253.41
âœ… Processed result 16: Columbia T-shirt - â‚¹1006.69
âœ… Processed result 17: Nike T-shirt - â‚¹986.58
âœ… Processed result 18: Nike T-shirt - â‚¹1775.94
âœ… Processed result 19: Huf T-shirt - â‚¹905.36
âœ… Processed result 20: Nike T-shirt - â‚¹359.67
âœ… Found and processed 20 products
â“ Checking if clarification is needed...
ğŸ” Too many high-confidence matches, asking for clarification...
ğŸ’¬ Generating response...
âœ… Response generated

ğŸ¤– Agent: What size are you looking for?

Example: "Do you need a medium or large size?"

ğŸ‘¤ You: medium

ğŸ”„ Turn 2 | User: medium
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: intent_classifier
ğŸ’­ Reasoning: The user input 'medium' is a single-word clarification response, likely specifying the size for the previously discussed product. There are no current search results, but historical results are available. This fits the clarification response criteria, so the next step is to continue the search flow.
ğŸ” Search context: Current=0, Historical=True
ğŸ¯ Classifying user intent...
âœ… Intent detected: modification
ğŸ” Extracting entities...
ğŸ“ Processing text-only input...
âœ… Extracted entities (text): {'size': 'M'}
ğŸ§µ Stitching conversation context...
ğŸ§© Stitched context: {'product_type': 't-shirt', 'brand': 'Puma', 'color': 'light grey', 'gender': 'male', 'pattern': 'graphic', 'size': 'M'}
ğŸ” Searching vector database...
ğŸ“ Search text: product_type: t-shirt. brand: Puma. color: light grey. gender: male. pattern: graphic. size: M
ğŸ“ Processing text search...
âœ… Processed result 1: Puma T-shirt - â‚¹421.51
âœ… Processed result 2: Puma T-shirt - â‚¹1689.5
âœ… Processed result 3: Puma T-shirt - â‚¹1480.5
âœ… Processed result 4: Puma T-shirt - â‚¹369.85
âœ… Processed result 5: Puma T-shirt - â‚¹724.26
âœ… Processed result 6: Puma T-shirt - â‚¹630.21
âœ… Processed result 7: Puma T-shirt - â‚¹1087.69
âœ… Processed result 8: Puma T-shirt - â‚¹1647.62
âœ… Processed result 9: Zara T-shirt - â‚¹1360.1
âœ… Processed result 10: Napapijri T-shirt - â‚¹1031.2
âœ… Processed result 11: Under Armour T-shirt - â‚¹618.47
âœ… Processed result 12: Nike T-shirt - â‚¹1380.29
âœ… Processed result 13: USPA T-shirt - â‚¹1847.7
âœ… Processed result 14: Nike T-shirt - â‚¹671.36
âœ… Processed result 15: Hurley T-shirt - â‚¹1253.41
âœ… Processed result 16: Nike T-shirt - â‚¹986.58
âœ… Processed result 17: GANT T-shirt - â‚¹1340.97
âœ… Processed result 18: Nike T-shirt - â‚¹1207.29
âœ… Processed result 19: Nike T-shirt - â‚¹739.73
âœ… Processed result 20: Adidas T-shirt - â‚¹1192.66
âœ… Found and processed 20 products
â“ Checking if clarification is needed...
ğŸ” Too many high-confidence matches, asking for clarification...
ğŸ’¬ Generating response...
âœ… Response generated

ğŸ¤– Agent: Do you prefer a specific graphic design or theme on the t-shirt?

Example: "Would you like a sports-themed graphic or something abstract?"

ğŸ‘¤ You: abstract

ğŸ”„ Turn 3 | User: abstract
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: intent_classifier
ğŸ’­ Reasoning: The user input 'abstract' is a single-word response that could be a clarification or a product search refinement (possibly referring to an abstract graphic pattern). There are no current search results, but historical results exist. No explicit cart or FAQ/analytics intent detected. The input is safe and in-domain.
ğŸ” Search context: Current=0, Historical=True
ğŸ¯ Classifying user intent...
âœ… Intent detected: clarification_response
ğŸ” Extracting entities...
ğŸ“ Processing text-only input...
âœ… Extracted entities (text): {}
ğŸ§µ Stitching conversation context...
ğŸ§© Stitched context: {'product_type': 't-shirt', 'brand': 'Puma', 'color': 'light grey', 'gender': 'male', 'pattern': 'graphic', 'size': 'M', 'graphic_type': 'abstract'}
ğŸ” Searching vector database...
ğŸ“ Search text: product_type: t-shirt. brand: Puma. color: light grey. gender: male. pattern: graphic. size: M. graphic_type: abstract
ğŸ“ Processing text search...
âœ… Processed result 1: Puma T-shirt - â‚¹421.51
âœ… Processed result 2: Puma T-shirt - â‚¹369.85
âœ… Processed result 3: Puma T-shirt - â‚¹1689.5
âœ… Processed result 4: Puma T-shirt - â‚¹1480.5
âœ… Processed result 5: Puma T-shirt - â‚¹630.21
âœ… Processed result 6: Puma T-shirt - â‚¹724.26
âœ… Processed result 7: Puma T-shirt - â‚¹1087.69
âœ… Processed result 8: Zara T-shirt - â‚¹1360.1
âœ… Processed result 9: Napapijri T-shirt - â‚¹1031.2
âœ… Processed result 10: Nike T-shirt - â‚¹671.36
âœ… Processed result 11: Hurley T-shirt - â‚¹1253.41
âœ… Processed result 12: USPA T-shirt - â‚¹1847.7
âœ… Processed result 13: Nike T-shirt - â‚¹986.58
âœ… Processed result 14: Puma T-shirt - â‚¹1647.62
âœ… Processed result 15: Nike T-shirt - â‚¹1625.59
âœ… Processed result 16: GANT T-shirt - â‚¹1340.97
âœ… Processed result 17: Nike T-shirt - â‚¹1032.15
âœ… Processed result 18: Nike T-shirt - â‚¹1775.94
âœ… Processed result 19: Nike T-shirt - â‚¹1864.29
âœ… Processed result 20: Basics T-shirt - â‚¹844.8
âœ… Found and processed 20 products
â“ Checking if clarification is needed...
ğŸ” Too many high-confidence matches, asking for clarification...
ğŸ’¬ Generating response...
âœ… Response generated

ğŸ¤– Agent: Do you have a preferred fit, like slim or regular?

Example: "Do you have a preferred fit, like slim or regular?"

ğŸ‘¤ You: slim

ğŸ”„ Turn 4 | User: slim
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: intent_classifier
ğŸ’­ Reasoning: The user input 'slim' is a single-word response likely clarifying a fit or style preference for the t-shirt search. There are no current search results, but historical results are available. This fits the clarification response pattern, so the next step is to continue the search flow.
ğŸ” Search context: Current=0, Historical=True
ğŸ¯ Classifying user intent...
âœ… Intent detected: modification
ğŸ” Extracting entities...
ğŸ“ Processing text-only input...
âœ… Extracted entities (text): {}
ğŸ§µ Stitching conversation context...
ğŸ§© Stitched context: {'product_type': 't-shirt', 'brand': 'Puma', 'color': 'light grey', 'gender': 'male', 'pattern': 'graphic', 'size': 'M', 'graphic_type': 'abstract', 'fit': 'slim'}
ğŸ” Searching vector database...
ğŸ“ Search text: product_type: t-shirt. brand: Puma. color: light grey. gender: male. pattern: graphic. size: M. graphic_type: abstract. fit: slim
ğŸ“ Processing text search...
âœ… Processed result 1: Puma T-shirt - â‚¹421.51
âœ… Processed result 2: Puma T-shirt - â‚¹1689.5
âœ… Processed result 3: Puma T-shirt - â‚¹369.85
âœ… Processed result 4: Puma T-shirt - â‚¹630.21
âœ… Processed result 5: Puma T-shirt - â‚¹1480.5
âœ… Processed result 6: Puma T-shirt - â‚¹724.26
âœ… Processed result 7: Puma T-shirt - â‚¹1087.69
âœ… Processed result 8: Zara T-shirt - â‚¹1360.1
âœ… Processed result 9: Napapijri T-shirt - â‚¹1031.2
âœ… Processed result 10: Hurley T-shirt - â‚¹1253.41
âœ… Processed result 11: Nike T-shirt - â‚¹671.36
âœ… Processed result 12: Puma T-shirt - â‚¹1647.62
âœ… Processed result 13: Nike T-shirt - â‚¹986.58
âœ… Processed result 14: Nike T-shirt - â‚¹1625.59
âœ… Processed result 15: Nike T-shirt - â‚¹1032.15
âœ… Processed result 16: Nike T-shirt - â‚¹1775.94
âœ… Processed result 17: Nike T-shirt - â‚¹1001.67
âœ… Processed result 18: GANT T-shirt - â‚¹1340.97
âœ… Processed result 19: Nike T-shirt - â‚¹1864.29
âœ… Processed result 20: Adidas T-shirt - â‚¹1892.69
âœ… Found and processed 20 products
â“ Checking if clarification is needed...
ğŸ›‘ Max clarifications reached.
ğŸ’¬ Generating response...
ğŸ“¦ Displaying 20 high-quality products
ğŸ“¦ Product 1: Puma T-shirt - Grey (â‚¹421.51, Score: 0.756)
ğŸ“¦ Product 2: Puma T-shirt - Light Pink (â‚¹1689.5, Score: 0.751)
ğŸ“¦ Product 3: Puma T-shirt - White (â‚¹369.85, Score: 0.75)
ğŸ“¦ Product 4: Puma T-shirt - Black (â‚¹630.21, Score: 0.746)
ğŸ“¦ Product 5: Puma T-shirt - Grey (â‚¹1480.5, Score: 0.746)
ğŸ“¦ Product 6: Puma T-shirt - ['White', 'Light Blue'] (â‚¹724.26, Score: 0.736)
ğŸ“¦ Product 7: Puma T-shirt - Light blue, purple, white (tie-dye/gradient) (â‚¹1087.69, Score: 0.733)
ğŸ“¦ Product 8: Zara T-shirt - Gray (â‚¹1360.1, Score: 0.709)
âœ… Response generated

ğŸ¤– Agent: Perfect! I found 8 excellent matches for your search:

1. Puma T-shirt (Grey)
   â‚¹421.51 | Cotton | Regular Fit
   ID: 125.jpg | Quality Score: 0.756

2. Puma T-shirt (Light Pink)
   â‚¹1689.5 | Cotton | Regular Fit
   ID: 173.jpg | Quality Score: 0.751

3. Puma T-shirt (White)
   â‚¹369.85 | Cotton | Regular Fit
   ID: 166.jpg | Quality Score: 0.75

4. Puma T-shirt (Black)
   â‚¹630.21 | Cotton | Regular Fit
   ID: 22.jpg | Quality Score: 0.746

5. Puma T-shirt (Grey)
   â‚¹1480.5 | Cotton | Regular Fit
   ID: 179.jpg | Quality Score: 0.746

6. Puma T-shirt (['White', 'Light Blue'])
   â‚¹724.26 | Cotton | Oversized Fit
   ID: 145.jpg | Quality Score: 0.736

7. Puma T-shirt (Light blue, purple, white (tie-dye/gradient))
   â‚¹1087.69 | Cotton | Regular Fit
   ID: 60.jpg | Quality Score: 0.733

8. Zara T-shirt (Gray)
   â‚¹1360.1 | Cotton | Oversized Fit
   ID: 45.jpg | Quality Score: 0.709

All products have high similarity scores (>0.6) for your requirements!

(12 more similar items available)

ğŸ‘¤ You: add 3rd to cart

ğŸ”„ Turn 5 | User: add 3rd to cart
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: cart_manager
ğŸ’­ Reasoning: The user gave an explicit cart action ('add 3rd to cart'). Although there are no current search results, historical search results are available, and adding to cart is allowed. According to the criteria, ADD actions with any search results (current or historical) should be routed to cart_manager.
ğŸ” Search context: Current=0, Historical=True
ğŸ›’ Handling cart operation...
ğŸ” Detected cart action: add
ğŸ“š Using search results from turn 4
âœ… Using standardized metadata structure
ğŸ” Final metadata: {'product_type': 'T-shirt', 'brand': 'Puma', 'color': 'White', 'material': 'Cotton', 'gender': 'Female', 'size': 'N/A', 'pattern': 'Graphic', 'theme': 'Casual', 'price_inr': 369.85, 'image_id': '166.jpg', 'fit': 'Regular', 'sleeve_type': 'Short Sleeve', 'neck_type': 'Crew Neck', 'visual_tags': ['printed', 'has text', 'graphic print'], 'category': 'Fashion', 'subcategory': "Women's Clothing"}
âœ… Successfully created cart item: Puma T-shirt

ğŸ¤– Agent: âœ… Added Puma T-shirt (White) - â‚¹369.85 to your cart!

ğŸ›’ Cart Summary (1 items):

1. Puma T-shirt - White
   â‚¹369.85 x 1 = â‚¹369.85

ğŸ’° Total: â‚¹369.85

ğŸ‘¤ You: what is total price of shortlisted items

ğŸ”„ Turn 6 | User: what is total price of shortlisted items
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: sql_agent
ğŸ’­ Reasoning: The user is asking for the total price of shortlisted (cart) items, which is an analytics/FAQ query about pricing. This matches the FAQ/analytics criteria. Search results context is not directly relevant since the query is about the cart's total price, not adding/removing items.
ğŸ” Search context: Current=0, Historical=True
ğŸ§¾ Running SQL agent for FAQ...
ğŸ¤” Question: what is total price of shortlisted items
âŒ SQL agent error: unsupported format string passed to NoneType.__format__

ğŸ¤– Agent: âŒ SQL agent error: unsupported format string passed to NoneType.__format__

ğŸ‘¤ You: what is average price of levis tshirts

ğŸ”„ Turn 7 | User: what is average price of levis tshirts
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: sql_agent
ğŸ’­ Reasoning: The user is asking for the average price of Levi's t-shirts, which is an analytics/FAQ query about catalog statistics. This matches the FAQ/analytics criteria. Search results context is not directly relevant since the question is about overall pricing, not a specific product or cart action.
ğŸ” Search context: Current=0, Historical=True
ğŸ§¾ Running SQL agent for FAQ...
ğŸ¤” Question: what is average price of levis tshirts
âŒ SQL agent error: unsupported format string passed to NoneType.__format__

ğŸ¤– Agent: âŒ SQL agent error: unsupported format string passed to NoneType.__format__

ğŸ‘¤ You: what is avergae price of tshirts

ğŸ”„ Turn 8 | User: what is avergae price of tshirts
ğŸ­ Supervisor analyzing request...
ğŸ¯ Decision: sql_agent
ğŸ’­ Reasoning: The user is asking for the average price of t-shirts, which is a catalog analytics query. This matches the FAQ/analytics criteria. Although there are no current search results, historical results are available, but the query is about statistics, not a specific product. No safety or out-of-domain concerns detected.
ğŸ” Search context: Current=0, Historical=True
ğŸ§¾ Running SQL agent for FAQ...
ğŸ¤” Question: what is avergae price of tshirts
âœ… SQL result sent.

ğŸ¤– Agent: ğŸ“Š what is avergae price of tshirts: â‚¹1,166.45